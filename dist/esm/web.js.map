{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import type { PermissionState } from '@capacitor/core';\r\nimport { WebPlugin } from '@capacitor/core';\r\nimport type { MessagePayload } from 'firebase/messaging';\r\nimport {\r\n  deleteToken,\r\n  getMessaging,\r\n  getToken,\r\n  isSupported as isSupportedInWeb,\r\n  onMessage,\r\n} from 'firebase/messaging';\r\n\r\nimport type {\r\n  Channel,\r\n  DeleteChannelOptions,\r\n  FirebaseMessagingPlugin,\r\n  GetDeliveredNotificationsResult,\r\n  GetTokenOptions,\r\n  GetTokenResult,\r\n  IsSupportedResult,\r\n  ListChannelsResult,\r\n  NotificationReceivedEvent,\r\n  PermissionStatus,\r\n  RemoveDeliveredNotificationsOptions,\r\n  SubscribeToTopicOptions,\r\n  UnsubscribeFromTopicOptions,\r\n} from './definitions';\r\nimport { Notification } from './definitions';\r\n\r\nexport class FirebaseMessagingWeb\r\n  extends WebPlugin\r\n  implements FirebaseMessagingPlugin\r\n{\r\n  public static readonly notificationReceivedEvent = 'notificationReceived';\r\n\r\n  constructor() {\r\n    super();\r\n    isSupportedInWeb().then(supported => {\r\n      if (!supported) {\r\n        return;\r\n      }\r\n      const messaging = getMessaging();\r\n      onMessage(messaging, payload => this.handleNotificationReceived(payload));\r\n    });\r\n  }\r\n\r\n  public async checkPermissions(): Promise<PermissionStatus> {\r\n    const receive = this.convertNotificationPermissionToPermissionState(\r\n      Notification.permission,\r\n    );\r\n    return {\r\n      receive,\r\n    };\r\n  }\r\n\r\n  public async requestPermissions(): Promise<PermissionStatus> {\r\n    const notificationPermission = await Notification.requestPermission();\r\n    const receive = this.convertNotificationPermissionToPermissionState(\r\n      notificationPermission,\r\n    );\r\n    return {\r\n      receive,\r\n    };\r\n  }\r\n\r\n  public async isSupported(): Promise<IsSupportedResult> {\r\n    const isSupported = await isSupportedInWeb();\r\n    return {\r\n      isSupported,\r\n    };\r\n  }\r\n\r\n  public async getToken(options: GetTokenOptions): Promise<GetTokenResult> {\r\n    const messaging = getMessaging();\r\n    const token = await getToken(messaging, {\r\n      vapidKey: options.vapidKey,\r\n      serviceWorkerRegistration: options.serviceWorkerRegistration,\r\n    });\r\n    return {\r\n      token,\r\n    };\r\n  }\r\n\r\n  public async deleteToken(): Promise<void> {\r\n    const messaging = getMessaging();\r\n    await deleteToken(messaging);\r\n  }\r\n\r\n  public async getDeliveredNotifications(): Promise<GetDeliveredNotificationsResult> {\r\n    this.throwUnavailableError();\r\n  }\r\n\r\n  public async removeDeliveredNotifications(\r\n    _options: RemoveDeliveredNotificationsOptions,\r\n  ): Promise<void> {\r\n    this.throwUnavailableError();\r\n  }\r\n\r\n  public async removeAllDeliveredNotifications(): Promise<void> {\r\n    this.throwUnavailableError();\r\n  }\r\n\r\n  public async subscribeToTopic(\r\n    _options: SubscribeToTopicOptions,\r\n  ): Promise<void> {\r\n    this.throwUnavailableError();\r\n  }\r\n\r\n  public async unsubscribeFromTopic(\r\n    _options: UnsubscribeFromTopicOptions,\r\n  ): Promise<void> {\r\n    this.throwUnavailableError();\r\n  }\r\n\r\n  public async createChannel(_options: Channel): Promise<void> {\r\n    this.throwUnavailableError();\r\n  }\r\n\r\n  public async deleteChannel(_options: DeleteChannelOptions): Promise<void> {\r\n    this.throwUnavailableError();\r\n  }\r\n\r\n  public async listChannels(): Promise<ListChannelsResult> {\r\n    this.throwUnavailableError();\r\n  }\r\n\r\n  private handleNotificationReceived(messagePayload: MessagePayload): void {\r\n    const notification = this.createNotificationResult(messagePayload);\r\n    const event: NotificationReceivedEvent = {\r\n      notification,\r\n    };\r\n    this.notifyListeners(FirebaseMessagingWeb.notificationReceivedEvent, event);\r\n  }\r\n\r\n  private createNotificationResult(\r\n    messagePayload: MessagePayload,\r\n  ): Notification {\r\n    const notification: Notification = {\r\n      body: messagePayload.notification?.body,\r\n      data: messagePayload.data,\r\n      id: messagePayload.messageId,\r\n      image: messagePayload.notification?.image,\r\n      title: messagePayload.notification?.title,\r\n    };\r\n    return notification;\r\n  }\r\n\r\n  private convertNotificationPermissionToPermissionState(\r\n    permission: NotificationPermission,\r\n  ) {\r\n    let state: PermissionState = 'prompt';\r\n    switch (permission) {\r\n      case 'granted':\r\n        state = 'granted';\r\n        break;\r\n      case 'denied':\r\n        state = 'denied';\r\n        break;\r\n    }\r\n    return state;\r\n  }\r\n\r\n  private throwUnavailableError(): never {\r\n    throw this.unavailable('Not available on web.');\r\n  }\r\n}\r\n"]}